

@page "/Iteminventory"
@inject iProduct productservices

<div class="container-fluid d-flex flex-column h-100 py-2">
        <Field class="d-flex flex-row justify-content-between px-1 my-0 pt-2">
            <Button class="d-block btn btn-success w-auto px-4 " Clicked="@ShowAddModal">Add</Button>
            @* <Button class="d-block btn btn-success w-auto px-4 " Clicked="@RefreshDataGrid">Refresh</Button> *@
            <TextEdit Placeholder="Search.." class="w-50" />
        </Field>

        <div class="mt-2">
            <Table>

            </Table>
        </div>

    


    <Modal @ref="modalref">
        <ModalContent Centered>
            <ModalHeader>
                <ModalTitle class="text-dark fw-bold">Add Item</ModalTitle>
            </ModalHeader>
            <ModalBody class="text-dark">
                <Field>
                    <FieldLabel>Product Name</FieldLabel>
                    <TextEdit Placeholder="Enter name..." @bind-Text="@prods.ProductName" />
                </Field>
                <Field>
                    <FieldLabel>Product Price</FieldLabel>
                    <NumericEdit @bind-Value="@prods.ProductPrice" Placeholder="Enter price..." />
                </Field>
            </ModalBody>
            <ModalFooter>
                <Button Color="Color.Secondary" Clicked="@HideModal">Close</Button>
                <Button Color="Color.Success" Clicked="@AddNewItem">Add Item</Button>
            </ModalFooter>
        </ModalContent>
    </Modal>

    <Modal Closing="@ClosingOKModal" @ref="OKModalref" Centered>
        <ModalContent Centered class="text-dark">
            <ModalHeader class="fw-bold">@AddingStatus</ModalHeader>
            <ModalBody>
                <h4>@AddingStatusTest</h4>
            </ModalBody>
            <ModalFooter>
                <Button Clicked="@closeOKModal" class="btn btn-success">OK</Button>
            </ModalFooter>
        </ModalContent>
    </Modal>
</div>



@code {
    List<ProductModel> products;
    private Modal? modalref; //adding item modal
    ProductInsert prods = new ProductInsert();
    bool visible = false;

    string AddingStatus = "";
    string AddingStatusTest = "";
    Modal OKModalref; //OK Modal
    bool cancelclosed;




    public Task ClosingOKModal(ModalClosingEventArgs e)
    {
        e.Cancel = cancelclosed
            || e.CloseReason != CloseReason.UserClosing;
        return Task.CompletedTask;

    }

    public Task closeOKModal()
    {
        cancelclosed = false;
        modalref.Hide();
        return OKModalref.Hide();

    }


    protected override async Task OnInitializedAsync()
    {
        // isLoading = true;
        await Getdata();
        // isLoading = false;

    }

    private async Task Getdata()
    {
        visible = true;
        products = await productservices.GetProducts();
        visible = false;

    }

    private Task ShowAddModal()
    {
        return modalref.Show();
    }

    private Task HideModal()
    {
        return modalref.Hide();
    }

    private async void AddNewItem()
    {

        bool IsAdded = false;

        IsAdded = await productservices.AddProdctItem(prods);
        prods.ProductName = string.Empty;
        prods.ProductPrice = 0;

        if (IsAdded)
        {
            AddingStatus = "Added Successfully";
            AddingStatusTest = "Infomrmation Added Succesfully";

            await Getdata();
            await OKModalref.Show();
            
        }
        else
        {
            AddingStatus = "Added Unsuccessfully";
            AddingStatusTest = "An Error Occured";
            await OKModalref.Show();

        }

    }



}
